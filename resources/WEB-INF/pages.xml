<?xml version="1.0" encoding="UTF-8"?>
<pages xmlns="http://jboss.com/products/seam/pages"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.2.xsd"
        no-conversation-view-id="/index.xhtml" http-port="8080">


    <conversation name="addProduct" parameter-name="storeId" parameter-value="#{productStore.storeId}" />


    <!-- add new store conversation -->
    <page view-id="/store/add.xhtml">
        <rewrite pattern="/store/add" />
        <description>Ввод имени новго магазина</description>
        <begin-conversation join="true" />
        <navigation from-action="#{storeManager.add()}">
            <rule if-outcome="success">
                <redirect view-id="/store/addStoreId.xhtml" />
            </rule>
        </navigation>
    </page>

    <page view-id="/store/addStoreId.xhtml" conversation-required="true">
        <rewrite pattern="/store/setid"/>
        <description>Ввод идентификатора нового магазина #{store.name}</description>
        <navigation from-action="#{storeManager.addStoreId()}">
            <rule if-outcome="success">
                <redirect view-id="/store/confirm.xhtml" />
            </rule>
        </navigation>
    </page>

    <page view-id="/store/confirm.xhtml" conversation-required="true">
        <rewrite pattern="/store/confirm" />
        <description>Подтверждение данных для нового магазина #{store.name}:#{store.storeId}</description>
        <navigation from-action="#{storeManager.confirm()}">
            <rule if-outcome="success">
                <end-conversation before-redirect="true" />
                <redirect view-id="/index.xhtml" />
            </rule>
        </navigation>
    </page>





    <!-- add new product conversation -->
    <page view-id="/product/add.xhtml" conversation="addProduct">
        <description>Добавить новый продукт в #{productStore.name}</description>
        <rewrite pattern="/store/{storeId}/add" />
        <param name="storeId" value="#{productManager.storeId}" />
        <begin-conversation join="true" />
        <navigation>
            <rule if-outcome="success">
                <redirect view-id="/product/confirm.xhtml" />
            </rule>
        </navigation>
    </page>

    <page view-id="/product/confirm.xhtml" conversation="addProduct" conversation-required="true">
        <description>Подтвердить данные по новому продукту (#{product.name}:#{product.store.name})</description>
        <rewrite pattern="/store/{storeId}/confirm" />
        <navigation>
            <rule if-outcome="success">
                <end-conversation />
                <redirect view-id="/index.xhtml" />
            </rule>
        </navigation>
    </page>


    <page view-id="/store.xhtml">
        <param name="storeId" value="#{storeManager.storeId}"/>
        <navigation>
            <rule if-outcome="success">
                <redirect view-id="/index.xhtml"/>
            </rule>
            <rule if-outcome="cancel">
                <end-conversation before-redirect="true" />
                <redirect view-id="/index.xhtml" />
            </rule>
        </navigation>
    </page>

    <page view-id="/viewstore.xhtml">
        <param name="storeId" value="#{storeManager.storeId}" />
        <param name="storeId" value="#{pm.storeId}" />

    </page>

    <page view-id="/*">
        <description>Отменить добавление нового объекта</description>
        <navigation>
            <rule if-outcome="cancel">
                <end-conversation before-redirect="true" />
                <redirect view-id="/index.xhtml" />
            </rule>
        </navigation>
    </page>


    <page view-id="/index.xhtml">
        <rewrite pattern="/" />
    </page>

    <page view-id="/product.xhtml">
        <rewrite pattern="/product/{id}" />
        <param name="id" value="#{product.urlAlias}"/>
    </page>


</pages>