<?xml version="1.0" encoding="UTF-8"?>
<components xmlns="http://jboss.com/products/seam/components"
            xmlns:core="http://jboss.com/products/seam/core"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns:persistence="http://jboss.com/products/seam/persistence"
            xmlns:framework="http://jboss.com/products/seam/framework"
            xmlns:web="http://jboss.com/products/seam/web"
            xsi:schemaLocation=
                    "http://jboss.com/products/seam/core http://jboss.com/products/seam/core-2.1.xsd
                    http://jboss.com/products/seam/web http://jboss.com/products/seam/web-2.2.xsd
               http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.1.xsd
               http://jboss.com/products/seam/framework http://jboss.com/products/seam/framework-2.2.xsd
               http://jboss.com/products/seam/persistence http://jboss.com/products/seam/persistence-2.2.xsd">

    <core:init debug="false"/>

    <core:manager conversation-timeout="120000"/>

    <persistence:entity-manager-factory name="extrastorefactory" persistence-unit-name="extrastore_pu_test"/>

    <!-- Strangely, <s:convertEntity /> fails with hard-to-trace NullPointerException, because "entityManger"
    injected variable name is hard-coded into seam persistence lib. So, we'd better use 'entityManager', not 'em' -->

    <persistence:managed-persistence-context name="entityManager" auto-create="true"
                                             entity-manager-factory="#{extrastorefactory}"/>

    <framework:entity-query name="prod"
               max-results="1">
        <framework:ejbql>select p from Product p</framework:ejbql>
        <framework:restrictions>
            <value>lower(p.urlAlias) like lower(#{product.urlAlias})</value>
        </framework:restrictions>
    </framework:entity-query>


    <web:rewrite-filter view-mapping="*.seam"/>

</components>
